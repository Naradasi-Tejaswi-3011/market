<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - MarketAI Suite</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1><span class="logo-icon"></span> MarketAI Suite</h1>
        </div>
        <div class="nav-menu">
            <a href="/" class="nav-link active">Home</a>
            <a href="/campaign" class="nav-link">Campaign Generator</a>
            <button id="logoutBtn" class="btn btn-logout">Logout</button>
        </div>
    </nav>
    
    <main class="container">
        <div class="dashboard-header">
            <h2>AI-Powered Marketing Intelligence</h2>
            <p>Generate data-driven marketing campaigns with explainable AI</p>
        </div>
        
        <div class="features-grid">
            <a href="/campaign" class="feature-card">
                <div class="feature-icon">ðŸŽ¯</div>
                <h3>AI Campaign Generator</h3>
                <p>Industry-specific marketing strategies powered by Groq AI</p>
                <span class="feature-count" id="campaignCount">âœ… Member 2 - Complete</span>
            </a>
            
            <a href="/pitch" class="feature-card">
                <div class="feature-icon">ðŸ’¬</div>
                <h3>AI Sales Pitch</h3>
                <p>Persona-aware pitch generation</p>
                <span class="feature-count" id="pitchCount" style="background: rgba(59, 130, 246, 0.1); color: #60a5fa; border-color: rgba(59, 130, 246, 0.2);">âŒ› Member 3 - Pending</span>
            </a>
            
            <a href="/lead" class="feature-card">
                <div class="feature-icon">ðŸ“Š</div>
                <h3>Lead Scoring</h3>
                <p>Intelligent lead classification</p>
                <span class="feature-count" id="leadCount" style="background: rgba(59, 130, 246, 0.1); color: #60a5fa; border-color: rgba(59, 130, 246, 0.2);">âŒ› Member 4 - Pending</span>
            </a>
        </div>
        
        <section class="recent-activity">
            <h3>Recent Activity</h3>
            <div id="activityList" class="activity-list">
                <p class="loading">Loading activity...</p>
            </div>
        </section>
    </main>
    
    <footer class="footer">
        <p>&copy; 2026 MarketAI Suite - Explainable AI for Business Intelligence</p>
    </footer>
    
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Check authentication
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = '/login';
                return;
            }
            
            // Load user info
            try {
                const response = await fetch('/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (!response.ok) {
                    window.location.href = '/login';
                }
            } catch (error) {
                window.location.href = '/login';
            }
            
            // Load counts
            await loadCounts();
            await loadActivity();
        });
        
        async function loadCounts() {
            const token = localStorage.getItem('token');
            
            try {
                const [campaignRes, pitchRes, leadRes] = await Promise.all([
                    fetch('/api/campaigns', { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch('/api/pitches', { headers: { 'Authorization': `Bearer ${token}` } }),
                    fetch('/api/leads', { headers: { 'Authorization': `Bearer ${token}` } })
                ]);
                
                if (campaignRes.ok) {
                    const data = await campaignRes.json();
                    document.getElementById('campaignCount').textContent = `${data.count} campaign${data.count !== 1 ? 's' : ''}`;
                }
                
                if (pitchRes.ok) {
                    const data = await pitchRes.json();
                    document.getElementById('pitchCount').textContent = `${data.count} pitch${data.count !== 1 ? 'es' : ''}`;
                }
                
                if (leadRes.ok) {
                    const data = await leadRes.json();
                    document.getElementById('leadCount').textContent = `${data.count} lead${data.count !== 1 ? 's' : ''}`;
                }
            } catch (error) {
                console.error('Error loading counts:', error);
            }
        }
        
        async function loadActivity() {
            const token = localStorage.getItem('token');
            
            try {
                const response = await fetch('/api/activity', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const activityHtml = data.activities.length > 0 
                        ? data.activities.map(a => `
                            <div class="activity-item">
                                <strong>${a.action.replace(/_/g, ' ')}</strong>
                                <span class="activity-time">${new Date(a.created_at).toLocaleString()}</span>
                            </div>
                        `).join('')
                        : '<p>No activity yet. Start generating campaigns, pitches, or scoring leads!</p>';
                    
                    document.getElementById('activityList').innerHTML = activityHtml;
                }
            } catch (error) {
                console.error('Error loading activity:', error);
            }
        }
        
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('token');
            localStorage.removeItem('user_id');
            localStorage.removeItem('email');
            window.location.href = '/login';
        });
    </script>
</body>
</html>
