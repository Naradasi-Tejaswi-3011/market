<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pitch Generator - MarketAI Suite</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <nav class="navbar">
        <div class="nav-brand">
            <h1><span class="logo-icon"></span> MarketAI Suite</h1>
        </div>
        <div class="nav-menu">
            <a href="/" class="nav-link">Home</a>
            <a href="/campaign" class="nav-link">Campaigns</a>
            <a href="/pitch" class="nav-link active">Pitches</a>
            <a href="/lead" class="nav-link">Leads</a>
            <button id="logoutBtn" class="btn btn-logout">Logout</button>
        </div>
    </nav>

    <main class="container">
        <div class="page-header">
            <h2>ðŸŽ¯ Sales Pitch Generator</h2>
            <p>Personalized pitches with confidence scoring and explainability</p>
        </div>

        <div class="content-grid">
            <!-- Input Form -->
            <div class="form-section">
                <h3>Generate New Pitch</h3>
                <form id="pitchForm" class="form-group">
                    <div>
                        <label for="product">Product Name *</label>
                        <input type="text" id="product" name="product" placeholder="Enter product name" required>
                    </div>

                    <div>
                        <label for="industry">Industry *</label>
                        <input type="text" id="industry" name="industry" placeholder="e.g., EdTech, Healthcare" required>
                    </div>

                    <div>
                        <label for="description">Product Description *</label>
                        <textarea id="description" name="description" placeholder="Describe your product and its key features" rows="4" required></textarea>
                    </div>

                    <div>
                        <label for="persona">Customer Persona *</label>
                        <input type="text" id="persona" name="persona" placeholder="e.g., CTO of mid-sized tech company" required>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="customer_type">WHO ARE YOU SELLING TO? *</label>
                            <select id="customer_type" name="customer_type" required>
                                <option value="">Select customer type</option>
                                <option value="Individual Customer">Individual Customer</option>
                                <option value="Small Business / Coaching Institute">Small Business / Coaching Institute
                                </option>
                                <option value="Educational Institute / College">Educational Institute / College</option>
                                <option value="Medium Company">Medium Company</option>
                                <option value="Large Enterprise">Large Enterprise</option>
                            </select>
                        </div>

                        <div class="form-col">
                            <label for="budget_preference">CUSTOMER BUDGET PREFERENCE *</label>
                            <select id="budget_preference" name="budget_preference" required>
                                <option value="">Select budget preference</option>
                                <option value="Budget Friendly">Budget Friendly (Below â‚¹30,000 per unit)</option>
                                <option value="Mid Range">Mid Range (â‚¹30,000 - â‚¹70,000)</option>
                                <option value="Premium">Premium (Above â‚¹70,000)</option>
                                <option value="Not Sure">Not Sure</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">
                        Generate Pitch
                    </button>
                </form>

                <div id="formMessage" class="message"></div>
            </div>

            <!-- Output Results -->
            <div class="results-section">
                <div id="toolDescription" class="tool-description">
                    <h3>AI Pitch Generator</h3>
                    <p>Generate personalized sales pitches powered by AI instantly.</p>
                    
                    <div class="feature-list">
                        <div class="feature-item">
                            <span class="feature-icon">ðŸ’¬</span>
                            <div>
                                <strong>Personalized Pitches</strong>
                                <p>Tailored to your customer persona and needs</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ðŸŽ¯</span>
                            <div>
                                <strong>Value Proposition</strong>
                                <p>Clearly articulated benefits and differentiators</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">ðŸ“ž</span>
                            <div>
                                <strong>Call to Action</strong>
                                <p>Optimized CTAs for conversion</p>
                            </div>
                        </div>
                        <div class="feature-item">
                            <span class="feature-icon">âš¡</span>
                            <div>
                                <strong>Instant Generation</strong>
                                <p>Get results in seconds with AI</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="how-it-works">
                        <h4>How It Works</h4>
                        <ol>
                            <li>Enter your product details</li>
                            <li>Describe your target customer</li>
                            <li>Select customer type and budget</li>
                            <li>Click Generate and get your personalized pitch</li>
                        </ol>
                    </div>
                </div>

                <div id="loadingSpinner" class="spinner" style="display: none;">
                    <div class="spinner-content">
                        <div class="spinner-circle"></div>
                        <p>Crafting personalized pitch...</p>
                    </div>
                </div>

                <div id="pitchOutput" style="display: none;">
                    <div class="output-card" style="position: relative;">
                        <button type="button" class="modal-close" onclick="window.closePitchOutput()" title="Close" style="position: absolute; right: 1.5rem; top: 1.5rem;">&times;</button>
                        <div class="pitch-header">
                            <div style="display: flex; justify-content: space-between; align-items: start; width: 100%;">
                                <div>
                                    <h3 id="resultProductName">Product Name</h3>
                                    <span id="resultDate" class="date-badge"></span>
                                </div>
                            </div>
                            <div class="tags">
                                <span id="resultIndustry" class="tag tag-blue">Industry</span>
                                <span id="resultCustomerType" class="tag tag-purple">Customer</span>
                            </div>
                        </div>

                        <hr class="divider">

                        <div class="output-section">
                            <h4>Customer Persona: <span id="resultPersona" class="output-value"></span></h4>
                            <h4>Customer Type: <span id="resultCustomerTypeDisplay" class="output-value"></span></h4>
                            <h4>Budget Preference: <span id="resultBudget" class="output-value"></span></h4>
                        </div>

                        <hr class="divider">

                        <div class="output-section">
                            <h4>Elevator Pitch:</h4>
                            <p id="elevatorPitch" class="pitch-text"></p>
                        </div>

                        <hr class="divider">

                        <div class="output-section">
                            <h4>Value Proposition:</h4>
                            <p id="valueProposition"></p>
                        </div>

                        <hr class="divider">

                        <div class="output-section">
                            <h4>Key Differentiators:</h4>
                            <ul id="differentiators" class="diff-list"></ul>
                        </div>

                        <hr class="divider">

                        <div class="output-section">
                            <h4>Call to Action:</h4>
                            <p id="personalizedCTA"></p>
                        </div>
                    </div>

                    <button id="savePitchBtn" class="btn btn-success" style="margin-top: 20px; width: 100%;">
                        âœ“ Save Pitch
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 MarketAI Suite - Explainable AI for Business Intelligence</p>
    </footer>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', checkAuth);
        document.getElementById('pitchForm').addEventListener('submit', generatePitch);
        document.getElementById('logoutBtn').addEventListener('click', logout);

        async function generatePitch(e) {
            e.preventDefault();

            const token = localStorage.getItem('token');
            const formData = {
                product: document.getElementById('product').value,
                description: document.getElementById('description').value,
                persona: document.getElementById('persona').value,
                industry: document.getElementById('industry').value,
                customer_type: document.getElementById('customer_type').value,
                budget_preference: document.getElementById('budget_preference').value,
                language: document.getElementById('language').value
            };

            document.getElementById('loadingSpinner').style.display = 'flex';
            document.getElementById('pitchOutput').style.display = 'none';
            document.getElementById('formMessage').textContent = '';

            try {
                const response = await fetch('/api/pitches/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                document.getElementById('loadingSpinner').style.display = 'none';

                if (response.ok) {
                    displayPitchOutput(data.pitch, formData);
                    currentPitchId = data.pitch_id;
                } else {
                    document.getElementById('formMessage').textContent = data.error || 'Error generating pitch';
                    document.getElementById('formMessage').classList.add('error');
                }
            } catch (error) {
                document.getElementById('loadingSpinner').style.display = 'none';
                document.getElementById('formMessage').textContent = 'Network error. Please try again.';
                document.getElementById('formMessage').classList.add('error');
            }
        }

        function displayPitchOutput(pitch, formData) {
            // Header Info
            document.getElementById('resultProductName').textContent = formData.product;
            document.getElementById('resultDate').textContent = new Date().toLocaleDateString();
            document.getElementById('resultIndustry').textContent = formData.industry;
            document.getElementById('resultCustomerType').textContent = formData.customer_type;

            // Details
            document.getElementById('resultPersona').textContent = formData.persona;
            document.getElementById('resultCustomerTypeDisplay').textContent = formData.customer_type;
            document.getElementById('resultBudget').textContent = formData.budget_preference;

            // Content
            document.getElementById('elevatorPitch').textContent = pitch.elevator_pitch;
            document.getElementById('valueProposition').textContent = pitch.value_proposition;

            document.getElementById('differentiators').innerHTML = pitch.key_differentiators
                .map(d => `<li>${d}</li>`)
                .join('');

            document.getElementById('personalizedCTA').textContent = pitch.personalized_cta;

            document.getElementById('pitchOutput').style.display = 'block';
        }

        let currentPitchId = null;

        window.closePitchOutput = function() {
            document.getElementById('pitchOutput').style.display = 'none';
            document.getElementById('toolDescription').style.display = 'block';
            document.getElementById('pitchForm').reset();
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('savePitchBtn').addEventListener('click', () => {
                alert('Pitch saved successfully!');
            });
        });
    </script>
</body>

</html>